# Partner API

This project is meant to manage partners

---
## How it works

Project is built using FAST-API which means everything is async.
Project's database is a MongoDB database. Default database address is a cloud stored db
meant for development use only. Indexes are predefined inside this DB.

---
## Project Setup

*This project is meant to run using **python 3.7**. Other versions may not work.*

All dependencies are listed on the [`requirements.txt`](requirements.txt) file. 
It's strongly recommended to run the application inside a virtual environment.

To run the API locally simply run 
```sh
$ make local
```
To build and run the API in a Docker container run
```sh
$ make run
```

### Documentation:
FAST-API's automatic documentation is stored at: [`/docs`](http://localhost:3000/docs)

#### Restrictions:

A partner is defined by all the fields represented by the JSON and rules below:
```json
{
  "id": 1, 
  "tradingName": "Adega da Cerveja - Pinheiros",
  "ownerName": "ZÃ© da Silva",
  "document": "36114640000170",
  "coverageArea": { 
    "type": "MultiPolygon", 
    "coordinates": [
      [[[30, 20], [45, 40], [10, 40], [30, 20]]], 
      [[[15, 5], [40, 10], [10, 20], [5, 10], [15, 5]]]
    ]
  },
  "address": { 
    "type": "Point",
    "coordinates": [-46.57421, -21.785741]
  }
}
```

1. The `address` field follows the `GeoJSON Point` format (https://en.wikipedia.org/wiki/GeoJSON);
2. The `coverageArea` field follows the `GeoJSON MultiPolygon` format (https://en.wikipedia.org/wiki/GeoJSON);
3. The `document` must is a unique field and must be a valid document of type CNPJ or CPF;
4. The `id` is a unique field automatically generated by MongoDB;

---
## Contributing
Due to the pre-commit setup, this project has strict formatting rules.

### Install the pre-commit
From inside the project's folder, run:
```sh
$ pip3 install -r requirements-dev.txt
$ pre-commit install
```

#### How to use
Every commit is automatically formatted in accordance with pre-commit configurations.
If you want to format all files without executing a commit, just run:
```sh
$ pre-commit run --all-files
```
---

---
## Tests

Tests were developed using pytest and mongomock dependency.
To run tests just use:
```sh
$ make test
```